<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css"
/>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>

<div class="card">
  <div class="card-header">
    <h3 class="card-title">Log Blast Message</h3>
    <div class="float-right">
      <select id="statusFilter" class="form-control" style="height: max-content;">
        <option value="">All Status</option>
        <option value="pending">Pending</option>
        <option value="processing">Processing</option>
        <option value="completed">Completed</option>
        <option value="failed">Failed</option>
      </select>
    </div>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table id="blastLogsTable" class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Waktu</th>
            <th>Nama Kontak</th>
            <th>Nomor</th>
            <th>Grup</th>
            <th>Pesan</th>
            <th>Tipe</th>
            <th>Media</th>
            <th>Status</th>
            <th>Jadwal</th>
          </tr>
        </thead>
        <tbody>
          <% logs.forEach(function(log) { %>
            <tr>
              <td><%= new Date(log.timestamp).toLocaleString() %></td>
              <td><%= log.contact_name %></td>
              <td><%= log.phone %></td>
              <td><%= log.group_name %></td>
              <td><%= log.message %></td>
              <td><%= log.message_type %></td>
              <td>
                <% if (log.media_name) { %>
                  <%= log.media_name %>
                <% } else { %>
                  -
                <% } %>
              </td>
              <td>
                <% if (log.status === 'pending') { %>
                  <span class="badge bg-warning"><%= log.status %></span>
                <% } else if (log.status === 'processing') { %>
                  <span class="badge bg-info"><%= log.status %></span>
                <% } else if (log.status === 'completed') { %>
                  <span class="badge bg-success"><%= log.status %></span>
                <% } else if (log.status === 'failed') { %>
                  <span class="badge bg-danger"><%= log.status %></span>
                <% } %>
              </td>
              <td>
                <% if (log.schedule_time) { %>
                  <%= new Date(log.schedule_time).toLocaleString() %>
                <% } else { %>
                  Langsung
                <% } %>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Tambahkan ini di bagian bawah file, sebelum closing body tag -->
<script>
$(document).ready(function() {
  var table = $('#blastLogsTable').DataTable({
    "responsive": true,
    "lengthChange": true,
    "autoWidth": false,
    "order": [[0, "desc"]], // Urutkan berdasarkan kolom waktu (descending)
    "language": {
      "url": "//cdn.datatables.net/plug-ins/1.10.24/i18n/Indonesian.json"
    }
  });
  
  // Filter berdasarkan status
  $('#statusFilter').on('change', function() {
    var status = $(this).val();
    table.column(5) // kolom status
        .search(status)
        .draw();
  });
});
</script>